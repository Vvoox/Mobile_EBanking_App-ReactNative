{"ast":null,"code":"var _interopRequireWildcard = require(\"@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Host = exports.Context = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _reactNative = require(\"react-native-web/dist/index\");\n\nvar _useKey2 = require(\"./hooks/useKey\");\n\nvar _manager = require(\"./manager.component\");\n\nvar _jsxFileName = \"/Users/pawankumar/Sites/react-native-magnus/src/ui/portal/host.component.tsx\";\nvar Context = React.createContext(null);\nexports.Context = Context;\n\nvar Host = function Host(_ref) {\n  var children = _ref.children,\n      style = _ref.style;\n  var managerRef = React.useRef(null);\n  var queue = [];\n\n  var _useKey = (0, _useKey2.useKey)(),\n      generateKey = _useKey.generateKey,\n      removeKey = _useKey.removeKey;\n\n  React.useEffect(function () {\n    var _managerRef$current, _managerRef$current2, _managerRef$current3;\n\n    while (queue.length && managerRef.current) {\n      var action = queue.pop();\n\n      if (action) {\n        switch (action.type) {\n          case 'mount':\n            (_managerRef$current = managerRef.current) === null || _managerRef$current === void 0 ? void 0 : _managerRef$current.mount(action.key, action.children);\n            break;\n\n          case 'update':\n            (_managerRef$current2 = managerRef.current) === null || _managerRef$current2 === void 0 ? void 0 : _managerRef$current2.update(action.key, action.children);\n            break;\n\n          case 'unmount':\n            (_managerRef$current3 = managerRef.current) === null || _managerRef$current3 === void 0 ? void 0 : _managerRef$current3.unmount(action.key);\n            break;\n        }\n      }\n    }\n  }, []);\n\n  var mount = function mount(children) {\n    var key = generateKey();\n\n    if (managerRef.current) {\n      managerRef.current.mount(key, children);\n    } else {\n      queue.push({\n        type: 'mount',\n        key: key,\n        children: children\n      });\n    }\n\n    return key;\n  };\n\n  var update = function update(key, children) {\n    if (managerRef.current) {\n      managerRef.current.update(key, children);\n    } else {\n      var op = {\n        type: 'mount',\n        key: key,\n        children: children\n      };\n      var index = queue.findIndex(function (o) {\n        return o.type === 'mount' || o.type === 'update' && o.key === key;\n      });\n\n      if (index > -1) {\n        queue[index] = op;\n      } else {\n        queue.push(op);\n      }\n    }\n  };\n\n  var unmount = function unmount(key) {\n    if (managerRef.current) {\n      managerRef.current.unmount(key);\n      removeKey(key);\n    } else {\n      queue.push({\n        type: 'unmount',\n        key: key\n      });\n    }\n  };\n\n  return React.createElement(Context.Provider, {\n    value: {\n      mount: mount,\n      update: update,\n      unmount: unmount\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 5\n    }\n  }, React.createElement(_reactNative.View, {\n    style: [{\n      flex: 1\n    }, style],\n    collapsable: false,\n    pointerEvents: \"box-none\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 7\n    }\n  }, children), React.createElement(_manager.Manager, {\n    ref: managerRef,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }\n  }));\n};\n\nexports.Host = Host;","map":{"version":3,"sources":["host.component.tsx"],"names":["Context","React","Host","children","style","managerRef","queue","generateKey","removeKey","action","mount","key","type","update","op","index","o","unmount","flex"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { View, ViewStyle } from 'react-native';\n\nimport { useKey } from './hooks/useKey';\nimport { Manager, IManagerHandles } from './manager.component';\n\ninterface IHostProps {\n  children: React.ReactNode;\n  style?: ViewStyle;\n}\n\nexport interface IProvider {\n  mount(children: React.ReactNode): string;\n  update(key?: string, children?: React.ReactNode): void;\n  unmount(key?: string): void;\n}\n\nexport const Context = React.createContext<IProvider | null>(null);\n\nexport const Host = ({ children, style }: IHostProps): JSX.Element => {\n  const managerRef = React.useRef<IManagerHandles>(null);\n  const queue: {\n    type: 'mount' | 'update' | 'unmount';\n    key: string;\n    children?: React.ReactNode;\n  }[] = [];\n  const { generateKey, removeKey } = useKey();\n\n  React.useEffect(() => {\n    while (queue.length && managerRef.current) {\n      const action = queue.pop();\n\n      if (action) {\n        switch (action.type) {\n          case 'mount':\n            managerRef.current?.mount(action.key, action.children);\n            break;\n          case 'update':\n            managerRef.current?.update(action.key, action.children);\n            break;\n          case 'unmount':\n            managerRef.current?.unmount(action.key);\n            break;\n        }\n      }\n    }\n  }, []);\n\n  const mount = (children: React.ReactNode): string => {\n    const key = generateKey();\n\n    if (managerRef.current) {\n      managerRef.current.mount(key, children);\n    } else {\n      queue.push({ type: 'mount', key, children });\n    }\n\n    return key;\n  };\n\n  const update = (key: string, children: React.ReactNode): void => {\n    if (managerRef.current) {\n      managerRef.current.update(key, children);\n    } else {\n      const op = { type: 'mount' as 'mount', key, children };\n      const index = queue.findIndex(\n        (o) => o.type === 'mount' || (o.type === 'update' && o.key === key)\n      );\n\n      if (index > -1) {\n        queue[index] = op;\n      } else {\n        queue.push(op);\n      }\n    }\n  };\n\n  const unmount = (key: string): void => {\n    if (managerRef.current) {\n      managerRef.current.unmount(key);\n      removeKey(key);\n    } else {\n      queue.push({ type: 'unmount', key });\n    }\n  };\n\n  return (\n    <Context.Provider value={{ mount, update, unmount }}>\n      <View\n        style={[{ flex: 1 }, style]}\n        collapsable={false}\n        pointerEvents=\"box-none\"\n      >\n        {children}\n      </View>\n\n      <Manager ref={managerRef} />\n    </Context.Provider>\n  );\n};\n"]},"metadata":{},"sourceType":"script"}